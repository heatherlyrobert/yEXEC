#!/usr/local/bin/koios
#   koios-polos (axis of heaven) unit testing meta-language



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
PREP          include the prototype headers                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
   incl       include public header                yEXEC.h                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
   incl       include private header               yEXEC_priv.h                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP  [··/·]  (SELF) verify heartbeat operations                                  0s  heartbeat       rptg_hearbeat, exec_time                                                     ((01.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       prepare for run                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     initialize the system                yexec__unit_quiet                                                                                                                 i_equal     0                                                                                                    
     local    create a heartbeat                   - - - - - - - - - - - - -   char  x_heartbeat  [LEN_HUND];                                                                                                                                                                                             
     local    create a file name                   - - - - - - - - - - - - -   char  x_file       [LEN_HUND] = "/tmp/yEXEC.heartbeat";                                                                                                                                                                    

   COND       prepare time                                                       - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartbeat             7654   , 1320105600             , NULL                                      , x_file , x_heartbeat    i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 46[11.10.31.17.00.00.1.44.304  1320105600    7654]                                
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 46[11.10.31.17.00.00.1.44.304  1320105600    7654]                                

   COND       prepare time                                                       - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartbeat             123    , 1494680400             , NULL                                      , x_file , x_heartbeat    i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 46[17.05.13.06.00.00.6.19.133  1494680400     123]                                
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 46[17.05.13.06.00.00.6.19.133  1494680400     123]                                

   COND       prepare time                                                       - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartbeat             123    , 1494680491             , NULL                                      , x_file , x_heartbeat    i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 46[17.05.13.06.01.31.6.19.133  1494680491     123]                                
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 46[17.05.13.06.01.31.6.19.133  1494680491     123]                                

   COND       prepare time with a suffix                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartbeat             123    , 1494680491             , "khronos"                                 , x_file , x_heartbeat    i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 55[17.05.13.06.01.31.6.19.133  1494680491     123  khronos]                       
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 55[17.05.13.06.01.31.6.19.133  1494680491     123  khronos]                       

   COND       prepare time with a signal data                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartbeat             98765  , 1320105600             , "yexec  SIGTERM (15) graceful termination", x_file, x_heartbeat     i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 88[11.10.31.17.00.00.1.44.304  1320105600   98765  yexec  SIGTERM (15) graceful termination] 
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 88[11.10.31.17.00.00.1.44.304  1320105600   98765  yexec  SIGTERM (15) graceful termination] 

   COND       wrap up testing                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.007))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     wrap up                              yexec__unit_end                                                                                                                   i_equal     0                                                                                                    



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP  [··/·]  (SELF) verify heartbeat operations                                  0s  heartlong       rptg_hearbeat, exec_time                                                     ((02.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       prepare for run                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     initialize the system                yexec__unit_quiet                                                                                                                 i_equal     0                                                                                                    
     local    create a heartbeat                   - - - - - - - - - - - - -   char  x_heartbeat  [LEN_HUND];                                                                                                                                                                                             
     local    create a file name                   - - - - - - - - - - - - -   char  x_file       [LEN_HUND] = "/tmp/yEXEC.heartbeat";                                                                                                                                                                    

   COND       prepare initial time                                               - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartlong             123    , 1494680400     ,      3,  NULL                                     , x_file, x_heartbeat     i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 58[17.05.13.06.00.00.6.19.133  1494680400     123    3s    <s]                    
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 58[17.05.13.06.00.00.6.19.133  1494680400     123    3s    <s]                    

   COND       verify advancing time                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartlong             123    , 1494680491     ,     45, NULL                                      , x_file , x_heartbeat    i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 58[17.05.13.06.01.31.6.19.133  1494680491     123   45s    1m]                    
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 58[17.05.13.06.01.31.6.19.133  1494680491     123   45s    1m]                    

   COND       verify advancing time                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     set the date                         yEXEC_heartlong             123    , 1495680000     ,     60, NULL                                      , x_file , x_heartbeat    i_equal     0                                                                                                    
     get      ...check heartbeat                   yexec_spec__unit            "heartbeat"            , x_file                                                                       s_equal     SELF heartbeat   : 58[17.05.24.19.40.00.3.21.144  1495680000     123    1m   11d]                    
     get      ...check last heartbeat              yexec_spec__unit            "lastbeat"             , x_file                                                                       s_equal     SELF lastbeat    : 58[17.05.24.19.40.00.3.21.144  1495680000     123    1m   11d]                    

   COND       wrap up testing                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     wrap up                              yexec__unit_end                                                                                                                   i_equal     0                                                                                                    



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP  [··/·]  (SELF) verify who am i                                              0s  whoami          yEXEC_whoami                                                                 ((03.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       prepare for run                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     initialize the system                yexec__unit_quiet                                                                                                                 i_equal     0                                                                                                    
     local    create a saved pid                   - - - - - - - - - - - - -   int   x_spid  = getpid ();                                                                                                                                                                                                 
     local    create a saved ppid                  - - - - - - - - - - - - -   int   x_sppid = getppid ();                                                                                                                                                                                                
     local    create a pid variable                - - - - - - - - - - - - -   int   x_pid  , x_ppid;                                                                                                                                                                                                     
     local    create a uid variable                - - - - - - - - - - - - -   int   x_uid  , x_euid;                                                                                                                                                                                                     
     local    create a uid variable                - - - - - - - - - - - - -   int   x_gid  , x_egid;                                                                                                                                                                                                     
     local    create a root variable               - - - - - - - - - - - - -   char  x_root  = '-';                                                                                                                                                                                                       
     local    create a user variable               - - - - - - - - - - - - -   char  x_user  [LEN_USER];                                                                                                                                                                                                  
     local    create a user variable               - - - - - - - - - - - - -   char  x_group [LEN_USER];                                                                                                                                                                                                  

   COND       verify as root                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call user validation                 yEXEC_whoami                &x_pid  , &x_ppid  , &x_uid  , &x_euid , &x_root  , x_user  , 'n'     , &x_gid  , &x_egid , x_group   i_equal     0                                                                                                    
     echo     ...check returned pid                - - - - - - - - - - - - -   x_pid                                                                                                 i_equal     [[ x_spid ]]                                                                                         
     echo     ...check returned ppid               - - - - - - - - - - - - -   x_ppid                                                                                                i_equal     [[ x_sppid ]]                                                                                        
     echo     ...check returned uid                - - - - - - - - - - - - -   x_uid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned euid               - - - - - - - - - - - - -   x_euid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned user               - - - - - - - - - - - - -   x_user                                                                                                w_equal     årootæ                                                                                               
     echo     ...check returned root flag          - - - - - - - - - - - - -   x_root                                                                                                c_equal     'y'                                                                                                  
     echo     ...check returned gid                - - - - - - - - - - - - -   x_gid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned egid               - - - - - - - - - - - - -   x_egid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned group              - - - - - - - - - - - - -   x_group                                                                                               w_equal     årootæ                                                                                               

   COND       verify moving to normal user (effective)                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     change to member                     - - - - - - - - - - - - -   seteuid (1000);                                                                                                                                                                                                            
     exec     call user validation                 yEXEC_whoami                &x_pid  , &x_ppid  , &x_uid  , &x_euid , &x_root  , x_user  , 'n'     , &x_gid  , &x_egid , x_group   i_equal     0                                                                                                    
     echo     ...check returned pid                - - - - - - - - - - - - -   x_pid                                                                                                 i_equal     [[ x_spid ]]                                                                                         
     echo     ...check returned ppid               - - - - - - - - - - - - -   x_ppid                                                                                                i_equal     [[ x_sppid ]]                                                                                        
     echo     ...check returned uid                - - - - - - - - - - - - -   x_uid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned euid               - - - - - - - - - - - - -   x_euid                                                                                                i_equal     1000                                                                                                 
     echo     ...check returned user               - - - - - - - - - - - - -   x_user                                                                                                w_equal     åmemberæ                                                                                             
     echo     ...check returned root flag          - - - - - - - - - - - - -   x_root                                                                                                i_equal     '-'                                                                                                  
     echo     ...check returned gid                - - - - - - - - - - - - -   x_gid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned egid               - - - - - - - - - - - - -   x_egid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned group              - - - - - - - - - - - - -   x_group                                                                                               w_equal     årootæ                                                                                               
     code     change back to root                  - - - - - - - - - - - - -   seteuid (   0);                                                                                                                                                                                                            

   COND       verify moving to another group (effective)                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     change to users                      - - - - - - - - - - - - -   setegid ( 100);                                                                                                                                                                                                            
     exec     call user validation                 yEXEC_whoami                &x_pid  , &x_ppid  , &x_uid  , &x_euid , &x_root  , x_user  , 'n'     , &x_gid  , &x_egid , x_group   i_equal     0                                                                                                    
     echo     ...check returned pid                - - - - - - - - - - - - -   x_pid                                                                                                 i_equal     [[ x_spid ]]                                                                                         
     echo     ...check returned ppid               - - - - - - - - - - - - -   x_ppid                                                                                                i_equal     [[ x_sppid ]]                                                                                        
     echo     ...check returned uid                - - - - - - - - - - - - -   x_uid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned euid               - - - - - - - - - - - - -   x_euid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned user               - - - - - - - - - - - - -   x_user                                                                                                w_equal     årootæ                                                                                               
     echo     ...check returned root flag          - - - - - - - - - - - - -   x_root                                                                                                i_equal     'y'                                                                                                  
     echo     ...check returned gid                - - - - - - - - - - - - -   x_gid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned egid               - - - - - - - - - - - - -   x_egid                                                                                                i_equal     100                                                                                                  
     echo     ...check returned group              - - - - - - - - - - - - -   x_group                                                                                               w_equal     åusersæ                                                                                              
     code     change back to root                  - - - - - - - - - - - - -   setegid (   0);                                                                                                                                                                                                            

   COND       wrap up testing                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     wrap up                              yexec__unit_end                                                                                                                   i_equal     0                                                                                                    



# end-of-file.  done, finito, completare, whimper [Ï´···
